<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <title>ملف المستخدم الاحترافي</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/users-profiles.css">
</head>

<body>

  {% if warning_message %}
  <div id="toast" class="show warning">
    <div id="img"><svg width="256px" height="256px" viewBox="0 0 14.00 14.00" xmlns="http://www.w3.org/2000/svg"
        fill="#fffafa" stroke="#fffafa" stroke-width="0.00014">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
          <g fill-rule="evenodd">
            <path d="M0 7a7 7 0 1 1 14 0A7 7 0 0 1 0 7z"></path>
            <path d="M13 7A6 6 0 1 0 1 7a6 6 0 0 0 12 0z" fill="#ff0000" style="fill: var(--svg-status-bg, #ff0000);">
            </path>
            <path
              d="M7 5.969L5.599 4.568a.29.29 0 0 0-.413.004l-.614.614a.294.294 0 0 0-.004.413L5.968 7l-1.4 1.401a.29.29 0 0 0 .004.413l.614.614c.113.114.3.117.413.004L7 8.032l1.401 1.4a.29.29 0 0 0 .413-.004l.614-.614a.294.294 0 0 0 .004-.413L8.032 7l1.4-1.401a.29.29 0 0 0-.004-.413l-.614-.614a.294.294 0 0 0-.413-.004L7 5.968z">
            </path>
          </g>
        </g>
      </svg></div>
    <div id="desc">{{ warning_message }}</div>
  </div>
  {% endif %}

  {% if message %}
  <div id="toast" class="show success">
    <div id="img"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" fill="#37ff00" stroke="#37ff00"
        stroke-width="0.01024">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
          <path fill="#00ff62"
            d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm-55.808 536.384-99.52-99.584a38.4 38.4 0 1 0-54.336 54.336l126.72 126.72a38.272 38.272 0 0 0 54.336 0l262.4-262.464a38.4 38.4 0 1 0-54.272-54.336L456.192 600.384z">
          </path>
        </g>
      </svg></div>
    <div id="desc">{{ message }}</div>
  </div>
  {% endif %}



  <div class="profile-container">
    <div class="profile-cover"></div>
    <div class="profile-avatar-section">
      <span class="profile-avatar-frame">
        {% if avatar_url %}
        <img src="{{ avatar_url }}" alt="الصورة الرمزية" width="100" style="border-radius: 50%;" class="profile-avatar"
          id="profileAvatar">
        {% else %}
        <p>❌ لا توجد صورة رمزية</p>
        {% endif %}
      </span>
      {% if num_cards >= 2 %}
      <span class="profile-badge" id="profileBadge">عضو مميز</span>
      {% endif %}

    </div>
    <div class="profile-main">
      <div class="profile-header">
        <div class="profile-info">
          <div class="profile-name" id="profileName">{{ session.username }}</div>
          <div class="profile-email" id="profileEmail">{{ session.user_email }}</div>
          <div class="profile-id" id="profileid">رقم المتسابق : {{ session.user_id }}</div>
        </div>
      </div>
      <hr>
      <div class="profile-stats">
        <div class="stat-box">
          {{num_cards}}
          <span class="stat-label">بطاقة</span>
        </div>
        <div class="stat-box">
          {{num_comments}}
          <span class="stat-label">عدد التعليقات</span>
        </div>
        <div class="stat-box">
          {{num_votes}}
          <span class="stat-label">عدد التصويتات</span>
        </div>
      </div>

    </div>

    <section class="projects" id="projects">
      {% if cards %}
      <div class="cards-container" id="cards-container" style="display:flex;">
        {% for card in cards %}
        <div class="flip-container" data-rank="{{ card.rank }}" data-card-id="{{ card.id }}"
          data-created="{{ card.created_at.strftime('%Y-%m-%dT%H:%M:%S') if card.created_at else '' }}">
          <div class="flipper" id="flipper">
            <!-- وجه الكارت -->
            <div class="project-card">
              <img src="{{ url_for('static', filename='uploads/' ~ card.card_img) }}" alt="{{ card.project_name }}"
                loading="lazy" width="400" height="250"
                onerror="this.onerror=null;this.src='https://placehold.co/400x250';">
              <div class="middle">
                <div class="text">{{ card.project_make_name }}</div>
              </div>
              {% if card.votes_count > 0 %}
              {% if card.rank == 1 %}
              <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" fill="#000000">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <g id="Flat">
                    <g id="Color">
                      <polygon fill="#212529" points="8.26 3 25.94 33.62 38.06 26.62 24.42 3 8.26 3"></polygon>
                      <path d="M38.06,26.62l-7.21-12.5-3.72,6.44a21.53,21.53,0,0,0-7,3l5.8,10Z" fill="#111315">
                      </path>
                      <polygon fill="#dd051d" points="34.6 28.62 29.4 31.62 12.87 3 19.8 3 34.6 28.62"></polygon>
                      <polygon fill="#212529" points="39.58 3 25.94 26.62 38.06 33.62 55.74 3 39.58 3"></polygon>
                      <path d="M34.6,28.62l-6.06-10.5-1.42,2.46a21.44,21.44,0,0,0-3.46,1.1l5.74,9.94Z" fill="#a60416">
                      </path>
                      <path d="M43.86,23.58a21.46,21.46,0,0,0-14.17-3.45l-3.75,6.49,12.12,7Z" fill="#111315"></path>
                      <polygon fill="#dd051d" points="51.13 3 34.6 31.62 29.4 28.62 44.2 3 51.13 3"></polygon>
                      <path d="M34.6,31.62l5.74-9.94a21.41,21.41,0,0,0-6-1.55L29.4,28.62Z" fill="#a60416"></path>
                      <circle cx="32" cy="41.5" fill="#fccd1d" r="19.5"></circle>
                      <circle cx="32" cy="41.5" fill="#f9a215" r="14.5"></circle>
                      <path
                        d="M34.13,43.63V33H29.88a3.19,3.19,0,0,1-3.19,3.19H25.63v4.25h4.25v3.19a2.13,2.13,0,0,1-2.13,2.12H25.63V50H38.38V45.75H36.25A2.12,2.12,0,0,1,34.13,43.63Z"
                        fill="#fccd1d"></path>
                    </g>
                  </g>
                </g>
              </svg>
              {% elif card.rank == 2 %}
              <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" fill="#000000">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <g id="Flat">
                    <g id="Color">
                      <polygon fill="#1c63ab" points="8.26 3 25.94 33.62 38.06 26.62 24.42 3 8.26 3"></polygon>
                      <path d="M38.06,26.62l-7.21-12.5-3.72,6.44a21.53,21.53,0,0,0-7,3l5.8,10Z" fill="#1c63ab">
                      </path>
                      <polygon fill="#dd051d" points="34.6 28.62 29.4 31.62 12.87 3 19.8 3 34.6 28.62"></polygon>
                      <polygon fill="#1c63ab" points="39.58 3 25.94 26.62 38.06 33.62 55.74 3 39.58 3"></polygon>
                      <path d="M34.6,28.62l-6.06-10.5-1.42,2.46a21.44,21.44,0,0,0-3.46,1.1l5.74,9.94Z" fill="#a60416">
                      </path>
                      <path d="M43.86,23.58a21.46,21.46,0,0,0-14.17-3.45l-3.75,6.49,12.12,7Z" fill="#1c63ab"></path>
                      <polygon fill="#dd051d" points="51.13 3 34.6 31.62 29.4 28.62 44.2 3 51.13 3"></polygon>
                      <path d="M34.6,31.62l5.74-9.94a21.41,21.41,0,0,0-6-1.55L29.4,28.62Z" fill="#a60416"></path>
                      <circle cx="32" cy="41.5" fill="#b5b0b0" r="19.5"></circle>
                      <circle cx="32" cy="41.5" fill="#d4d3d3" r="14.5"></circle>
                      <path
                        d="M33.88,33.57a6.49,6.49,0,0,0-5.81,1.23,6.41,6.41,0,0,0-2.21,4.89H30c0-2.24,3.37-2.38,4-1,1,2.1-8,7-8,7v4H38v-4H34a7.07,7.07,0,0,0,4-7.54A6.16,6.16,0,0,0,33.88,33.57Z"
                        fill="#b5b0b0"></path>
                    </g>
                  </g>
                </g>
              </svg>
              {% elif card.rank == 3 %}
              <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" fill="#000000">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <g id="Flat">
                    <g id="Color">
                      <polygon fill="#212529" points="45 17 32 25 19 17 19 3 45 3 45 17"></polygon>
                      <polygon fill="#dd051d" points="40 3 40 20.08 32 25 24 20.08 24 3 40 3"></polygon>
                      <path d="M32,25l6.49-4a21.36,21.36,0,0,0-13,0Z" fill="#a60416"></path>
                      <circle cx="32" cy="41.5" fill="#CD7F32" r="19.5"></circle>
                      <circle cx="32" cy="41.5" fill="#fc9d03" r="14.5"></circle>
                      <path
                        d="M36.54,41.5A4.52,4.52,0,0,0,38.38,38c0-2.76-2.86-5-6.38-5s-6.37,2.24-6.37,5h3.92a2,2,0,0,1,3.9-.29c.17,1.23-.77,2.73-2,2.73v2.12c2.22,0,2.84,3.5.72,4.32A2,2,0,0,1,29.55,45H25.63c0,2.76,2.85,5,6.37,5s6.38-2.24,6.38-5A4.52,4.52,0,0,0,36.54,41.5Z"
                        fill="#CD7F32"></path>
                    </g>
                  </g>
                </g>
              </svg>
              {% endif %}
              {% endif %}
              <div class="project-content">
                <span style="color:#888; font-size:14px;">رقم المتسابق: <b name="card_id" value="{{ card.id }}">{{
                    card.id
                    }}</b></span>

                <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                  <div class="project-title" style="display: flex; align-items: center; gap: 3px;">
                    {{ card.project_name }}
                  </div>

                  {% if card.user_id == session_user_id %}
                  <button class="edit-btn" id="edit-btn" onclick="showEditFields()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                      stroke="currentColor" class="size-6">
                      <path stroke-linecap="round" stroke-linejoin="round"
                        d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                    </svg>
                    تعديل البيانات
                  </button>
                  {% else %}


                  {% endif %}


                </div>
                <div class="project-desc">{{ card.project_desc }}</div>
                <div class="project-info">
                  <span class="project-maker"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                      stroke="#2d6a4f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                      style="vertical-align:middle;">
                      <circle cx="12" cy="8" r="4"></circle>
                      <path d="M4 20v-1a4 4 0 014-4h8a4 4 0 014 4v1"></path>
                    </svg>{{ card.project_make_name }}</span>
                  <span class="project-email"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                      stroke="#1976d2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                      style="vertical-align:middle;">
                      <rect x="3" y="5" width="18" height="14" rx="2"></rect>
                      <polyline points="3 7 12 13 21 7"></polyline>
                    </svg>
                    {{ card.project_email }}</span>
                </div>
                <div class="category-div">
                  {% for word in (card.project_category or '').split() %}
                  <span class="project-category">{{ word }}</span>
                  {% endfor %}
                </div>
                <a class="explore-btn" href="{{ card.project_url }}" target="_blank">استكشاف الموقع وتجربته</a>

                <form class="edit-fields" id="edit-fields" style="display:none;" action="save_edits_profiles"
                  method="post" enctype="multipart/form-data">

                  <label for="card_id">رقم المتسابق *</label>
                  <input type="text" name="card_id" value="{{ card.id }}" readonly>

                  <label for="project_name">اسم الموقع *</label>
                  <input type="text" id="new_project_name" name="new_project_name" required
                    value="{{ card.project_name }}" autocomplete="on">

                  <label for="project_img">رابط صورة الموقع *</label>
                  <input type="file" id="new_project_img" name="new_project_img" accept="image/*" autocomplete="on">
                  <label>اسم الملف الحالي: <b style="color:#7693fc;">{{ card.card_img }}</b></label><br>

                  <label for="project_desc">الوصف *</label>
                  <textarea id="new_project_desc" name="new_project_desc" required
                    autocomplete="on">{{ card.project_desc }}</textarea>

                  <label for="project_url">رابط الموقع *</label>
                  <input type="link" id="new_project_url" name="new_project_url" required value="{{ card.project_url }}"
                    autocomplete="on">

                  <label for="project_category">الفئة</label>
                  <span style="font-size: 12px ; color: #5f5f5f; margin-right: 5px;">*ضع مسافة بين كل كلمة و أخري
                    *</span>
                  <input type="text" id="new_project_category" name="new_project_category" required
                    value="{{ card.project_category }}" autocomplete="on">

                  <label for="project_make_name">اسم المؤلف</label>
                  <input type="text" id="new_project_make_name" name="new_project_make_name" required
                    value="{{ card.project_make_name }}" autocomplete="on">

                  <label for="project_email">أدخل بريدك الالكتروني</label>
                  <input type="email" id="new_project_email" name="new_project_email" required
                    value="{{ card.project_email }}" autocomplete="on">

                  <div style="display:flex;gap:7px;justify-content:flex-end;">
                    <button type="submit" class="save-btn">حفظ البيانات</button>
                    <button type="button" class="cancel-btn" onclick="hideEditFields()">إلغاء</button>
                  </div>
                </form>

                <hr class="divider" />

                <form action="add_comment" method="post">
              </div>
              <div class="comment-section">
                <div class="comment-header">أضف تعليقك</div>
                <div class="comment-controls">
                  <input type="hidden" name="card_id" value="{{ card.id }}">
                  <!-- the flask take the user_id from this -->
                  <input type="text" placeholder="اكتب تعليقك هنا..." class="comment-input" name="comment-input" />
                  <button class="add-comment">إرسال</button>
                </div>
              </div>
              </form>

              <button onclick="flipCard({{ card.id }})" class="show-comments">
                عرض التعليقات (<span class="commentsCount">{{ card.comments|length }}</span>)
              </button>

              <div class="stars-container" data-card-id="{{ card.id }}"
                data-already-voted="{{ 'true' if card.already_voted else 'false' }}"
                data-user-vote="{{ card.user_vote or 0 }}">
                <span class="star" data-value="1">&#9733;</span>
                <span class="star" data-value="2">&#9733;</span>
                <span class="star" data-value="3">&#9733;</span>
                <span class="star" data-value="4">&#9733;</span>
                <span class="star" data-value="5">&#9733;</span>
                <span class="vote-message"
                  style="display:block;margin-top:6px;color:#1a9c62;font-size:14px;min-height:18px;"></span>
              </div>

              <div class="votes-info"
                style="margin-bottom: 15px;color:#555;font-size:14px;text-align: center;padding: 5px;">
                <!-- نجمة ذهبية SVG -->
                <svg width="16" height="16" style="position:relative; top:2px;" viewBox="0 0 24 24">
                  <path fill="#FFD700" d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.56 5.82 22 
                  7 14.14l-5-4.87 6.91-1.01z" />
                </svg>
                المتوسط : {{ card.avg_vote }} |
                <!-- أيقونة شخصين SVG -->
                <svg width="16" height="16" style="position:relative; top:2px; margin-left: 2px;" viewBox="0 0 24 24">
                  <path fill="#555" d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 
                  3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 
                  3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5C15 14.17 10.33 13 8 13zm8 0c-.29 
                  0-.62.02-.97.05C17.16 13.66 20 14.84 20 16.5V19h4v-2.5c0-2.33-4.67-3.5-8-3.5z" />
                </svg>
                عدد التصويتات: {{ card.votes_count }}
              </div>
            </div>

            <!-- ظهر الكارت -->
            <div class="card-back">
              <div class="comments-title">التعليقات (<span class="commentsCount">{{ card.comments|length }}</span>)
              </div>
              <div class="comments-list-container">
                {% if card.comments %}
                {% for comment in card.comments %}
                <div class="comment-item">
                  <div class="comment-user">{{ comment.user_name }} :</div>
                  <div class="comment-text">{{ comment.comment_text }}</div>
                  <div class="comment-date">{{ comment.created_at }}</div>
                </div>
                {% endfor %}
                {% else %}
                <div class="no-comments">لا يوجد تعليقات بعد.</div>
                {% endif %}
              </div>
              <button onclick="flipCardBack({{ card.id }})" class="hide-comments"
                style="float:left; cursor: pointer;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                  fill="none" stroke="#222" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18" />
                  <line x1="6" y1="6" x2="18" y2="18" />
                </svg></button>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div style="text-align: center; width: 100%; margin:0 40px 40px 40px; font-size: 20px; color: #92a4ec;" id="no-projects">
        لا توجد مشاريع حالياً للعرض.
      </div>
      {% endif %}

    </section>

  </div>

</body>

</html>